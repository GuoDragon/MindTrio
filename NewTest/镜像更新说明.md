# 华为云ModelArts镜像更新说明

## 📅 更新日期
2025-11-20

## 🔄 镜像变更

### 旧镜像信息（已弃用）
- **镜像名称**：mindspore_2_7-vllm-mindspeed-cann8_2alpha2_ubuntu22
- **镜像版本**：ma20250630
- **所属组织**：mindspore0904
- **MindSpore版本**：2.7.0
- **CANN版本**：8.2 alpha2

### 新镜像信息（当前使用）
- **镜像名称**：ms2.7.1-cann8.2rc1
- **镜像版本**：v3
- **所属组织**：mindspore courses
- **MindSpore版本**：2.7.1（内置）
- **CANN版本**：8.2 rc1（内置）
- **Python版本**：3.10

---

## ✅ 已更新的文件

### 1. train.ipynb
**更新位置**：第1个markdown cell的"训练环境"部分

**更新内容**：
```markdown
### 训练环境
- 镜像：ms2.7.1-cann8.2rc1（名称）、v3（版本）、mindspore courses（所属组织）
- 实例规格：Ascend: 1*ascend-snt9b1 | ARM: 24核 192GB
```

### 2. 操作指南.md
**更新位置**：第11行，"1.1.1 创建Notebook实例"章节

**当前状态**：✅ 已包含新镜像信息（无需修改）

**内容**：
```markdown
- 镜像选择：`ms2.7.1-cann8.2rc1`（名称）、`v3`（版本）、`mindspore courses`（所属组织）
```

### 3. 更新说明.md
**更新位置**：新增"环境配置要求"章节（第10-40行）

**新增内容**：
- 华为云ModelArts配置说明
- 自定义镜像详细信息
- 实例规格要求
- 版本兼容性说明

### 4. merge.ipynb
**检查结果**：✅ 无需更新（该文件不包含环境说明）

---

## 🔍 版本兼容性分析

### MindSpore版本变化
| 项目 | 旧版本 | 新版本 | 影响 |
|------|--------|--------|------|
| MindSpore | 2.7.0 | 2.7.1 | ✅ 小版本升级，向后兼容 |
| CANN | 8.2 alpha2 | 8.2 rc1 | ✅ 更稳定的发布候选版本 |
| Python | 3.10 | 3.10 | ✅ 无变化 |

### mindnlp 0.5.1 兼容性
- ✅ **完全兼容** MindSpore 2.7.0
- ✅ **完全兼容** MindSpore 2.7.1
- ✅ **无需修改** requirements.txt

### 建议
1. **优先使用**镜像内置的 MindSpore 2.7.1
2. **无需降级**到 2.7.0（除非遇到特殊问题）
3. **如有问题**可使用以下命令降级：
   ```bash
   pip install mindspore==2.7.0 --force-reinstall
   ```

---

## 📋 验证清单

### 镜像信息一致性验证
- ✅ train.ipynb：已更新为新镜像
- ✅ 操作指南.md：已包含新镜像
- ✅ 更新说明.md：已添加环境配置章节
- ✅ merge.ipynb：无需更新
- ✅ 无旧镜像信息残留

### 文档完整性验证
- ✅ 所有文档使用统一格式：**名称、版本、所属组织**
- ✅ 实例规格信息一致
- ✅ 版本兼容性说明完整

---

## 🚀 使用新镜像的步骤

### 步骤1：创建Notebook实例
1. 登录华为云ModelArts控制台
2. 选择"Notebook"服务
3. 点击"创建"按钮

### 步骤2：配置镜像
在创建页面中选择：
- **镜像类型**：自定义镜像
- **镜像名称**：ms2.7.1-cann8.2rc1
- **镜像版本**：v3
- **所属组织**：mindspore courses

### 步骤3：配置实例规格
- **计算资源**：选择 Ascend NPU
- **规格**：1*ascend-snt9b1
- **CPU/内存**：24核 192GB
- **磁盘**：50GB或以上

### 步骤4：创建并启动
1. 点击"立即创建"
2. 等待实例创建完成
3. 点击"打开"进入Jupyter环境

### 步骤5：安装依赖
在Terminal中执行：
```bash
cd /home/ma-user/work/
pip install -r requirements.txt
```

---

## ⚠️ 注意事项

### 1. 镜像选择
- ✅ **必须使用**指定的自定义镜像
- ❌ **不要使用**公共镜像或其他版本
- ⚠️ 确认镜像的**所属组织**为"mindspore courses"

### 2. 版本管理
- 新镜像内置 MindSpore 2.7.1，可直接使用
- requirements.txt 中仍指定 mindspore==2.7.0，但兼容
- 如需严格匹配，可在安装依赖后执行降级命令

### 3. 兼容性
- ✅ 新镜像与所有现有脚本完全兼容
- ✅ 不需要修改任何训练代码
- ✅ 依赖配置保持不变

### 4. 迁移建议
- 如果已有旧镜像的实例，建议重新创建使用新镜像
- 训练checkpoint可以直接迁移使用
- 数据文件可以直接复用

---

## 📞 技术支持

如果在使用新镜像时遇到问题：

1. **版本冲突**：查看"版本兼容性分析"章节
2. **镜像找不到**：确认"所属组织"选择正确
3. **其他问题**：参考"操作指南.md"的常见问题章节

---

## 📝 更新历史

| 日期 | 更新内容 | 说明 |
|------|---------|------|
| 2025-11-20 | 镜像信息更新 | 从旧镜像切换到 ms2.7.1-cann8.2rc1 |
| 2025-11-20 | 文档同步更新 | 更新所有相关文档中的镜像信息 |
| 2025-11-19 | mindnlp 0.5.1 适配 | 完成版本适配和脚本优化 |

---

**✅ 镜像更新完成！** 现在可以使用新镜像开始训练了。
