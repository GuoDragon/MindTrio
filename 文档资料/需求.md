# 任务定义
我正在进行中文篇章级句间关系分析任务，目的是通过采用MindSpore框架LoRA微调DeepSeek-R1-Distill-Qwen-1.5B大模型

# 任务背景
1. 我之前在今年8月份的时候已经跑过全流程了，相关文件和结果在`D:\hw\OldTest`中存有备份，相关最佳的微调结果权重在`D:\hw\checkpoint-1380`中有备份
2. 所有相关实验都在华为云ModelArts中的Nootbook中进行，选择的镜像是**mindspore_2_7-vllm-mindspeed-cann8_2alpha2_ubuntu22（名称）、ma20250630（版本）、mindspore0904（所属组织）**，实例规格为**Ascend: 1*ascend-snt9b1|ARM: 24核 192GB**
3. 之前华为昇思老师的宣讲材料在`D:\hw\资料手册`中，可以作为一定的参考资料
4. 但是现在随着版本更新，完全按照之前的版本已经跑不通了
5. 用中文回答我
6. 最好使用 ipynb 格式，便于调试
7. 所有相关代码和文件都需要在华为云ModelArts的Notebook中运行
8. 同步生成指南文件，告诉我该如何操作
9. 生成的相关内容存放在`D:\hw\NewTest`中

# 已完成的环境配置
1. 我使用了`python3 -m venv lcl`创建了一个新的虚拟环境`lcl`，并通过`python -m ipykernel install --user --name lcl --display-name "Python (lcl)"`安装了相应的jupyter内核，所有的环境都在这个虚拟环境下配置，所有的脚本都在这个jupyter notebook中运行
2. 我已经在华为云ModelArts的Notebook中通过`pip install mindnlp==0.5.1`成功安装了**mindnlp0.5.1**版本
3. 由于mindnlp0.5.1已经包含了绝大多数需要的库，所以我没有再安装requirements.txt中列出的其他库

# 当前任务
1. train.ipynb 会卡在 trainer.train() 很长时间最后报错，详情见`D:\lcl\MindSpore_CCNU_MindTrio\NewTest\training.ipynb`
2. 卡在 trainer.train() 的时候 npu 的占用情况为：
```
+------------------------------------------------------------------------------------------------+
| npu-smi 23.0.6                   Version: 23.0.6                                               |
+---------------------------+---------------+----------------------------------------------------+
| NPU   Name                | Health        | Power(W)    Temp(C)           Hugepages-Usage(page)|
| Chip                      | Bus-Id        | AICore(%)   Memory-Usage(MB)  HBM-Usage(MB)        |
+===========================+===============+====================================================+
| 2     910B4               | OK            | 98.5        39                0    / 0             |
| 0                         | 0000:C2:00.0  | 0           0    / 0          6321 / 32768         |
+===========================+===============+====================================================+
+---------------------------+---------------+----------------------------------------------------+
| NPU     Chip              | Process id    | Process name             | Process memory(MB)      |
+===========================+===============+====================================================+
| 2       0                 | 42083         | python                   | 3538                    |
+===========================+===============+====================================================+
```
3. 你可以参考我之前的代码`D:\lcl\MindSpore_CCNU_MindTrio\OldTest`，不过这是今年8月份的代码，所以可能会有一些差异